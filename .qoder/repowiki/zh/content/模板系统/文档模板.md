# 文档模板

<cite>
**本文档中引用的文件**  
- [spec-template.md](file://templates/spec-template.md)
- [plan-template.md](file://templates/plan-template.md)
- [tasks-template.md](file://templates/tasks-template.md)
- [create-new-feature.sh](file://scripts/bash/create-new-feature.sh)
- [setup-plan.sh](file://scripts/bash/setup-plan.sh)
- [memory/constitution.md](file://memory/constitution.md)
</cite>

## 目录
1. [引言](#引言)
2. [模板系统概览](#模板系统概览)
3. [功能规范模板 (spec-template.md)](#功能规范模板-spec-templatemd)
4. [实施计划模板 (plan-template.md)](#实施计划模板-plan-templatemd)
5. [任务列表模板 (tasks-template.md)](#任务列表模板-tasks-templatemd)
6. [模板生成脚本分析](#模板生成脚本分析)
7. [宪法文件与治理机制](#宪法文件与治理机制)
8. [模板定制最佳实践](#模板定制最佳实践)
9. [实际修改案例](#实际修改案例)
10. [结论](#结论)

## 引言

Spec-Kit 是一个结构化项目开发框架，其核心在于通过标准化的文档模板系统驱动整个开发流程。该系统以 `spec-template.md`、`plan-template.md` 和 `tasks-template.md` 三个核心模板为基础，分别作为生成项目功能规范、技术实施计划和开发任务列表的结构化蓝图。这些模板不仅定义了文档的章节结构和字段含义，还通过内嵌的执行流程和占位符机制，指导AI或开发者系统性地完成从需求分析到任务分解的全过程。本文件将全面解析这一模板系统的工作原理、结构设计及其与自动化脚本的集成方式。

## 模板系统概览

Spec-Kit 的文档模板系统是一个分阶段、流水线式的开发引导机制。整个流程始于一个用户描述的功能需求，通过一系列模板和脚本，逐步将其转化为可执行的开发任务。

该系统的核心是三个递进的模板：
1.  **功能规范模板 (spec-template.md)**：聚焦于“做什么”（WHAT），从用户需求出发，明确功能目标、用户场景和业务价值，避免涉及技术实现细节。
2.  **实施计划模板 (plan-template.md)**：聚焦于“如何做”（HOW），在规范的基础上，引入技术上下文、架构决策和设计文档，将业务需求转化为技术方案。
3.  **任务列表模板 (tasks-template.md)**：聚焦于“执行”（EXECUTION），根据实施计划，生成一个有序、可并行、带有明确文件路径的开发任务清单。

这三个模板通过 `create-new-feature.sh` 和 `setup-plan.sh` 等脚本进行动态填充和实例化，确保了项目文档的一致性和自动化生成能力。

**Section sources**
- [spec-template.md](file://templates/spec-template.md#L1-L116)
- [plan-template.md](file://templates/plan-template.md#L1-L225)
- [tasks-template.md](file://templates/tasks-template.md#L1-L126)

## 功能规范模板 (spec-template.md)

`spec-template.md` 是项目开发的起点，其设计原则是“以用户为中心，以业务为导向”。

### 核心结构与字段含义

- **## 执行流程 (main)**：定义了生成规范的算法化步骤。它要求从用户描述中提取关键概念，标记所有不明确之处（使用 `[NEEDS CLARIFICATION: ...]` 占位符），并强制进行审查，确保规范的完整性和清晰度。
- **## ⚡ 快速指南**：明确了规范的编写原则，强调关注用户需求（WHAT）而非技术实现（HOW），目标读者是业务利益相关者。
- **## 用户场景与测试**：强制要求描述主要用户故事和验收场景（Given-When-Then格式），确保需求可测试。
- **## 需求**：列出具体、可测试的功能需求（FR-XXX）。模板鼓励对模糊的需求使用 `[NEEDS CLARIFICATION]` 标记，体现了“不猜测”的严谨性。
- **## 关键实体**：当功能涉及数据时，要求定义核心数据实体及其关系，但不涉及具体实现（如数据库表结构）。
- **## 审查与验收清单**：包含内容质量和需求完整性的自动化检查项，是规范完成的“质量门禁”。

### 占位符设计逻辑

模板中的占位符（如 `[FEATURE NAME]`、`[DATE]`、`[NEEDS CLARIFICATION: ...]`）是其动态性的关键。`[FEATURE NAME]` 和 `[DATE]` 会被脚本自动填充；而 `[NEEDS CLARIFICATION]` 是一种“主动模糊”机制，它不是遗漏，而是明确标识出需要进一步澄清的假设，确保规范的严谨性，防止过早做出技术决策。

**Section sources**
- [spec-template.md](file://templates/spec-template.md#L1-L116)

## 实施计划模板 (plan-template.md)

`plan-template.md` 是连接业务需求与技术实现的桥梁，它将功能规范转化为可执行的技术蓝图。

### 核心结构与字段含义

- **## 执行流程 (/plan 命令范围)**：详细描述了 `/plan` 命令的处理逻辑，包括加载规范、填充技术上下文、进行宪法检查、执行设计阶段（Phase 0 和 Phase 1）等。它明确指出该命令在生成任务列表前停止，体现了职责分离。
- **## 技术上下文**：定义了项目的关键技术参数，如语言版本、依赖库、存储方案、目标平台等。这些字段常以 `NEEDS CLARIFICATION` 开头，引导后续的研究阶段。
- **## 宪法检查**：引用 `memory/constitution.md` 中的项目核心原则，作为技术决策的“宪法性”约束。任何设计都必须通过此检查，否则需要重构。
- **## 项目结构**：提供了文档和源代码的目录结构模板，开发者需根据实际情况选择并填充。
- **## 阶段 0：概要与研究**：指导如何将技术上下文中的未知项转化为具体的研究任务。
- **## 阶段 1：设计与契约**：定义了设计阶段的输出，包括数据模型、API契约、契约测试和代理文件（agent file）的增量更新。
- **## 阶段 2：任务规划方法**：描述了后续 `/tasks` 命令将如何生成任务，但不实际执行。

### 占位符设计逻辑

除了常规的 `[FEATURE]`、`[DATE]`、`[link]` 外，该模板的占位符更侧重于技术决策的引导。`NEEDS CLARIFICATION` 在技术上下文中的使用，将不确定性显式化，并直接驱动研究阶段的创建。`__AGENT__` 占位符在脚本路径中，用于动态指定要更新的AI代理类型。

**Section sources**
- [plan-template.md](file://templates/plan-template.md#L1-L225)

## 任务列表模板 (tasks-template.md)

`tasks-template.md` 是开发执行的最终指南，它将设计文档转化为一系列原子化的、有序的开发任务。

### 核心结构与字段含义

- **## 执行流程 (main)**：定义了任务生成的算法，包括加载计划和设计文档、按类别生成任务、应用并行和TDD规则、验证任务完整性等。
- **## 格式: `[ID] [P?] 描述`**：规定了任务的命名规范。`[P]` 标记表示该任务可以与其他任务并行执行，这是优化开发效率的关键。
- **## 阶段 3.1：设置**：包含项目初始化、依赖安装等前置任务。
- **## 阶段 3.2：测试先行 (TDD)**：强制要求在编写任何实现代码之前，先编写并确保契约测试和集成测试失败，这是对“测试驱动开发”原则的硬性规定。
- **## 阶段 3.3：核心实现**：包含模型、服务、CLI命令等核心代码的实现任务。
- **## 依赖关系**：明确列出了任务间的依赖，确保执行顺序正确。
- **## 并行示例**：提供了一个并行执行多个测试任务的示例，指导开发者如何高效工作。

### 占位符设计逻辑

该模板的占位符较少，因为它更侧重于生成具体的、带有精确文件路径的任务描述。其“动态性”主要体现在任务生成规则上，例如根据 `contracts/` 目录下的每个文件自动生成一个契约测试任务。

**Section sources**
- [tasks-template.md](file://templates/tasks-template.md#L1-L126)

## 模板生成脚本分析

Spec-Kit 使用 Bash 和 PowerShell 脚本来自动化模板的实例化过程，确保了工作流的顺畅。

### create-new-feature.sh 脚本

该脚本是整个流程的入口点。

- **功能**：根据用户提供的功能描述，自动创建一个新的功能分支（如 `001-user-login`），在 `specs/` 目录下创建对应的子目录，并将 `spec-template.md` 复制为 `spec.md`。
- **执行逻辑**：
  1.  解析命令行参数和功能描述。
  2.  通过 `git` 或文件系统标记（如 `.specify`）确定仓库根目录。
  3.  递增生成三位数的特征编号（`001`, `002`...）。
  4.  根据特征编号和描述生成分支名称。
  5.  创建分支和特征目录。
  6.  复制 `spec-template.md` 到新目录下的 `spec.md`。
  7.  设置 `SPECIFY_FEATURE` 环境变量，为后续脚本提供上下文。

此脚本实现了从“想法”到“项目空间”的一键创建，极大地降低了启动新功能的门槛。

**Section sources**
- [create-new-feature.sh](file://scripts/bash/create-new-feature.sh#L1-L97)

### setup-plan.sh 脚本

该脚本负责启动实施计划的创建。

- **功能**：在已有的特征分支上，将 `plan-template.md` 复制到特征目录下，生成 `plan.md` 文件。
- **执行逻辑**：
  1.  加载 `common.sh` 中的共享函数，获取当前特征的路径信息（如 `FEATURE_DIR`, `IMPL_PLAN`）。
  2.  验证当前是否处于正确的特征分支上。
  3.  确保特征目录存在。
  4.  将 `plan-template.md` 复制到 `IMPL_PLAN`（即 `specs/[branch]/plan.md`）路径。

该脚本依赖于 `create-new-feature.sh` 创建的上下文，确保了工作流的连贯性。

**Section sources**
- [setup-plan.sh](file://scripts/bash/setup-plan.sh#L1-L60)

## 宪法文件与治理机制

`memory/constitution.md` 是整个Spec-Kit系统的“最高法律”，它定义了项目的不可协商的核心原则。

### 核心作用

该文件通过模板化的方式，要求项目明确其核心原则（如“库优先”、“CLI接口”、“测试先行”等）、额外约束和开发流程。这些原则在 `plan-template.md` 的“宪法检查”部分被引用，成为技术决策的强制性检查点。

### 与模板系统的集成

当 `plan-template.md` 被填充时，`setup-plan.sh` 或其他流程会引导用户根据 `constitution.md` 的内容来填写“宪法检查”部分。如果设计违反了宪法原则（例如，没有先写测试），则必须提供合理的理由并记录在“复杂性跟踪”表格中，否则开发流程将被阻止。这确保了项目的技术栈和架构风格始终保持一致和高质量。

**Section sources**
- [memory/constitution.md](file://memory/constitution.md#L1-L49)

## 模板定制最佳实践

为了适应不同项目的需求，对模板进行定制是必要的。以下是最佳实践：

1.  **扩展字段以适应复杂项目**：
    *   在 `spec-template.md` 中，可以为特定领域（如金融、医疗）添加“合规性要求”或“安全审计”等可选章节。
    *   在 `plan-template.md` 的“技术上下文”中，可以增加“第三方集成”、“性能目标”等字段。
    *   在 `tasks-template.md` 中，可以增加“代码审查”、“部署”等后期阶段。

2.  **确保模板可读性以提升AI理解准确性**：
    *   **使用清晰的标题和注释**：像 `## ⚡ 快速指南` 这样的部分，能有效引导AI的行为。
    *   **明确的占位符语义**：使用 `NEEDS CLARIFICATION` 而不是简单的 `TODO`，能更精确地表达意图。
    *   **提供示例**：在模板中包含示例（如 `Acceptance Scenarios` 的Given-When-Then格式），能显著提高AI生成内容的质量。
    *   **避免歧义**：使用肯定、明确的指令，避免模糊的描述。

3.  **保持向后兼容**：在修改模板时，尽量保留原有结构和关键占位符，以确保现有脚本和工作流不受影响。

## 实际修改案例

假设一个项目需要加强安全性，可以在其 `spec-template.md` 中进行如下修改：

**修改前**：
```markdown
## User Scenarios & Testing *(mandatory)*
...
```

**修改后**：
```markdown
## User Scenarios & Testing *(mandatory)*
...

## Security & Compliance *(mandatory for features handling user data)*
- **Data Encryption**: All [data type, e.g., passwords, PII] MUST be encrypted at rest and in transit using [NEEDS CLARIFICATION: encryption standard].
- **Access Control**: Access to [feature/data] MUST be restricted to users with [NEEDS CLARIFICATION: required role/permission].
- **Audit Logging**: All access and modification attempts to [feature/data] MUST be logged with user ID, timestamp, and action.
```

此修改为处理用户数据的功能增加了强制性的安全审查环节，通过 `[NEEDS CLARIFICATION]` 占位符确保了关键安全决策不会被忽略。

## 结论

Spec-Kit的文档模板系统是一个高度结构化和自动化的开发框架。`spec-template.md`、`plan-template.md` 和 `tasks-template.md` 三个模板构成了一个从需求到执行的完整闭环。通过精心设计的章节结构、字段含义和占位符逻辑，这些模板不仅提供了文档框架，更充当了开发流程的“程序代码”。结合 `create-new-feature.sh` 和 `setup-plan.sh` 等脚本，实现了文档的自动化生成和工作流的无缝衔接。`memory/constitution.md` 则作为治理核心，确保了技术决策的一致性和高质量。通过遵循最佳实践对模板进行定制，团队可以构建出一个强大、灵活且符合自身需求的项目开发体系。