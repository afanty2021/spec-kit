# 贡献指南

<cite>
**本文档中引用的文件**  
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [AGENTS.md](file://AGENTS.md)
- [src/specify_cli/__init__.py](file://src/specify_cli/__init__.py)
- [README.md](file://README.md)
- [pyproject.toml](file://pyproject.toml)
- [CHANGELOG.md](file://CHANGELOG.md)
- [scripts/bash/update-agent-context.sh](file://scripts/bash/update-agent-context.sh)
- [scripts/powershell/update-agent-context.ps1](file://scripts/powershell/update-agent-context.ps1)
</cite>

## 目录
1. [简介](#简介)
2. [报告问题与功能请求](#报告问题与功能请求)
3. [提交代码更改](#提交代码更改)
4. [扩展点：添加新的AI代理支持](#扩展点添加新的ai代理支持)
5. [代码风格与测试要求](#代码风格与测试要求)
6. [提交信息规范](#提交信息规范)
7. [结论](#结论)

## 简介

欢迎为Spec-Kit项目做出贡献！本项目旨在通过Spec-Driven Development（SDD）方法论，帮助开发者在构建软件时专注于产品场景而非编写重复性代码。您的贡献将有助于完善这一工具包，使其支持更多AI代理并提升开发效率。

本指南将详细介绍如何报告问题、提出功能请求以及提交代码更改。特别地，我们将深入探讨一个关键的扩展点：如何为新的AI代理添加支持。通过结合`AGENTS.md`中的信息和`src/specify_cli/__init__.py`中的代码实现，您将学习到需要修改的文件（如`AI_CHOICES`字典、`agent_folder_map`映射）和需要添加的资源（如新的模板文件夹）。此外，我们还将涵盖代码风格、测试要求和提交信息规范，以确保贡献的质量和一致性。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L110)
- [README.md](file://README.md#L1-L582)

## 报告问题与功能请求

当您在使用Spec-Kit时遇到问题或有新的功能想法时，可以通过GitHub Issues进行报告。请遵循以下步骤：

1. **搜索现有问题**：在提交新问题之前，请先搜索是否已有类似的问题被提出。这有助于避免重复工作。
2. **选择合适的问题模板**：GitHub仓库提供了问题模板，包括“Bug Report”和“Feature Request”。请选择最适合您情况的模板。
3. **提供详细信息**：
   - 对于Bug报告，请提供复现步骤、预期行为、实际行为以及您的环境信息（操作系统、Python版本等）。
   - 对于功能请求，请详细描述您希望实现的功能及其对项目的潜在价值。
4. **披露AI使用情况**：如果您在撰写问题或功能请求时使用了AI辅助，请在描述中明确说明。例如：“此问题描述由GitHub Copilot生成。”

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L110)
- [README.md](file://README.md#L1-L582)

## 提交代码更改

提交代码更改是为Spec-Kit项目做贡献的核心方式。请遵循以下流程以确保您的更改能够顺利被接受：

1. **Fork并克隆仓库**：首先，Fork Spec-Kit仓库到您的个人账户，然后将其克隆到本地。
2. **安装依赖**：使用`uv sync`命令安装项目所需的依赖项。
3. **创建新分支**：基于主分支创建一个新分支，用于您的更改。建议使用描述性的分支名称，例如`add-windsurf-support`。
4. **进行更改**：在新分支上进行您的代码更改。确保遵循项目的编码规范。
5. **编写测试**：为新功能编写相应的测试用例，并确保所有现有测试仍然通过。
6. **推送并提交Pull Request**：将您的更改推送到Fork的仓库，并提交一个Pull Request（PR）。在PR描述中，请详细说明您的更改内容和目的。

>[!NOTE]
>如果您的PR引入了重大变更（例如，引入新的模板、参数或对CLI的重大修改），请确保在提交PR之前与项目维护者进行讨论并获得同意。未经事先讨论的重大变更PR可能会被关闭。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L110)

## 扩展点：添加新的AI代理支持

为Spec-Kit添加对新AI代理的支持是一个重要的扩展点。以下是详细的步骤指南，以Windsurf为例说明如何完成这一过程。

### 1. 更新AI_CHOICES常量

首先，需要在`src/specify_cli/__init__.py`文件中更新`AI_CHOICES`字典，以包含新的AI代理。例如，添加Windsurf支持：

```python
AI_CHOICES = {
    "copilot": "GitHub Copilot",
    "claude": "Claude Code", 
    "gemini": "Gemini CLI",
    "cursor": "Cursor",
    "qwen": "Qwen Code",
    "opencode": "opencode",
    "windsurf": "Windsurf"  # 添加新代理
}
```

同时，更新`agent_folder_map`以包含新代理的文件夹路径：

```python
agent_folder_map = {
    "claude": ".claude/",
    "gemini": ".gemini/",
    "cursor": ".cursor/",
    "qwen": ".qwen/",
    "opencode": ".opencode/",
    "windsurf": ".windsurf/",  # 添加新代理文件夹
    "kilocode": ".kilocode/",
    "auggie": ".auggie/",
    "copilot": ".github/"
}
```

### 2. 更新CLI帮助文本

接下来，更新所有相关的帮助文本和示例，以包含新代理的信息。这包括：
- `--ai`参数的帮助说明
- 函数文档字符串和示例
- 包含代理列表的错误消息

### 3. 更新README文档

在`README.md`文件中更新“Supported AI Agents”部分，以包含新代理。确保添加以下信息：
- 代理的官方网址链接
- 支持级别（完全支持/部分支持）
- 任何相关的实现注意事项

### 4. 更新发布包脚本

修改`.github/workflows/scripts/create-release-packages.sh`脚本，以包含新代理的包。具体步骤如下：
- 将新代理添加到`ALL_AGENTS`数组中
- 在`case`语句中添加新代理的目录结构处理逻辑

### 5. 更新代理上下文脚本

#### Bash脚本 (`scripts/bash/update-agent-context.sh`)

添加文件变量：
```bash
WINDSURF_FILE="$REPO_ROOT/.windsurf/rules/specify-rules.md"
```

在`case`语句中添加新代理的处理逻辑：
```bash
case "$AGENT_TYPE" in
  # ... existing cases ...
  windsurf) update_agent_file "$WINDSURF_FILE" "Windsurf" ;;
  "") 
    # ... existing checks ...
    [ -f "$WINDSURF_FILE" ] && update_agent_file "$WINDSURF_FILE" "Windsurf";
    # Update default creation condition
    ;;
esac
```

#### PowerShell脚本 (`scripts/powershell/update-agent-context.ps1`)

添加文件变量：
```powershell
$windsurfFile = Join-Path $repoRoot '.windsurf/rules/specify-rules.md'
```

在`switch`语句中添加新代理的处理逻辑：
```powershell
switch ($AgentType) {
    # ... existing cases ...
    'windsurf' { Update-AgentFile $windsurfFile 'Windsurf' }
    '' {
        foreach ($pair in @(
            # ... existing pairs ...
            @{file=$windsurfFile; name='Windsurf'}
        )) {
            if (Test-Path $pair.file) { Update-AgentFile $pair.file $pair.name }
        }
        # Update default creation condition
    }
}
```

### 6. 更新CLI工具检查（可选）

对于需要CLI工具的代理，可以在`check()`命令和代理验证中添加检查。例如，为Windsurf添加CLI检查：

```python
# In check() command
tracker.add("windsurf", "Windsurf IDE (optional)")
windsurf_ok = check_tool_for_tracker("windsurf", "https://windsurf.com/", tracker)

# In init validation (only if CLI tool required)
elif selected_ai == "windsurf":
    if not check_tool("windsurf", "Install from: https://windsurf.com/"):
        console.print("[red]Error:[/red] Windsurf CLI is required for Windsurf projects")
        agent_tool_missing = True
```

**注意**：对于IDE-based代理（如Copilot、Windsurf），可以跳过CLI检查。

### 7. 测试新代理集成

完成上述更改后，需要进行全面的测试以确保新代理的集成成功。测试步骤包括：
1. **构建测试**：本地运行包创建脚本
2. **CLI测试**：测试`specify init --ai <agent>`命令
3. **文件生成**：验证正确的目录结构和文件生成
4. **命令验证**：确保生成的命令能与代理正常工作
5. **上下文更新**：测试代理上下文更新脚本

**Section sources**
- [AGENTS.md](file://AGENTS.md#L1-L271)
- [src/specify_cli/__init__.py](file://src/specify_cli/__init__.py#L67-L79)
- [scripts/bash/update-agent-context.sh](file://scripts/bash/update-agent-context.sh#L0-L199)
- [scripts/powershell/update-agent-context.ps1](file://scripts/powershell/update-agent-context.ps1#L0-L199)

## 代码风格与测试要求

为了保持代码的一致性和可维护性，Spec-Kit项目遵循严格的代码风格和测试要求。

### 代码风格

- **Python版本**：项目要求使用Python 3.11或更高版本。
- **依赖管理**：使用`uv`进行包管理。
- **编码规范**：遵循PEP 8编码规范，并使用`typer`、`rich`等库来增强CLI的用户体验。

### 测试要求

- **单元测试**：为所有新功能编写单元测试，确保代码的正确性。
- **集成测试**：验证新功能与现有系统的集成情况。
- **测试覆盖率**：确保测试覆盖率达到较高水平，避免遗漏关键路径。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L110)
- [pyproject.toml](file://pyproject.toml#L1-L23)

## 提交信息规范

良好的提交信息有助于维护者理解每次更改的目的和内容。请遵循以下规范：

- **简洁明了**：提交信息应简洁明了，准确描述更改内容。
- **使用动词开头**：例如，“Add support for Windsurf”而不是“Added support for Windsurf”。
- **关联问题**：如果提交与某个问题相关，请在提交信息中引用该问题编号，例如“Fix #123”。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L110)

## 结论

通过遵循本贡献指南，您可以有效地为Spec-Kit项目做出贡献。无论是报告问题、提出功能请求还是提交代码更改，您的参与都将帮助项目不断进步。特别地，添加对新AI代理的支持是一个重要的扩展点，能够显著提升项目的适用范围和灵活性。请确保在贡献过程中遵守代码风格、测试要求和提交信息规范，以确保贡献的质量和一致性。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L110)
- [AGENTS.md](file://AGENTS.md#L1-L271)
- [src/specify_cli/__init__.py](file://src/specify_cli/__init__.py#L67-L79)