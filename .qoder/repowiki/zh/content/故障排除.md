# 故障排除

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [SUPPORT.md](file://SUPPORT.md)
- [scripts/bash/check-prerequisites.sh](file://scripts/bash/check-prerequisites.sh)
- [scripts/powershell/check-prerequisites.ps1](file://scripts/powershell/check-prerequisites.ps1)
- [scripts/bash/common.sh](file://scripts/bash/common.sh)
- [scripts/powershell/common.ps1](file://scripts/powershell/common.ps1)
</cite>

## 目录
1. [简介](#简介)
2. [安装问题](#安装问题)
3. [环境检查问题](#环境检查问题)
4. [AI代理连接问题](#ai代理连接问题)
5. [脚本执行错误](#脚本执行错误)
6. [诊断技巧](#诊断技巧)

## 简介
本指南旨在帮助用户解决在使用Spec-Kit过程中可能遇到的常见问题。基于README.md和SUPPORT.md中的信息，系统性地列出问题类别，如安装失败、环境检查报错、AI代理连接问题、脚本执行错误等。针对每个问题，提供清晰的症状描述、可能的原因分析和分步的解决方案。

## 安装问题

### 安装命令未找到
**症状**：运行`uv tool install specify-cli --from git+https://github.com/github/spec-kit.git`时提示命令未找到。

**可能原因**：
- `uv`工具未安装
- `uv`未正确添加到PATH环境变量

**解决方案**：
1. 首先安装`uv`：
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
pipx install uv
```
2. 验证`uv`是否在PATH中：
```bash
uv --version
```
3. 如果未找到，将`uv`的安装目录添加到PATH环境变量。

**Section sources**
- [README.md](file://README.md#L100-L120)

## 环境检查问题

### `specify check`命令报错
**症状**：运行`specify check`命令时报告某些工具未找到。

**可能原因**：
- 所需工具未安装
- 工具未正确添加到PATH环境变量
- 系统架构不匹配

**解决方案**：
1. 检查PATH环境变量：
```bash
echo $PATH
```
2. 验证特定工具是否可执行：
```bash
which git
which python
```
3. 如果工具已安装但不在PATH中，添加其安装路径：
```bash
export PATH=$PATH:/path/to/tool
```
4. 对于Windows用户，确保在PowerShell或命令提示符中正确配置环境变量。

**Section sources**
- [README.md](file://README.md#L55-L60)
- [scripts/bash/check-prerequisites.sh](file://scripts/bash/check-prerequisites.sh#L70-L100)

## AI代理连接问题

### AI代理工具未检测到
**症状**：`specify init`命令无法检测到已安装的AI代理（如Claude Code、Gemini CLI等）。

**可能原因**：
- AI代理未正确安装
- AI代理的可执行文件不在PATH中
- 代理版本不兼容

**解决方案**：
1. 使用`--ignore-agent-tools`标志跳过代理检查：
```bash
specify init <project_name> --ai claude --ignore-agent-tools
```
2. 手动验证AI代理是否可执行：
```bash
claude --version
gemini --version
```
3. 如果代理已安装但不可执行，将其安装目录添加到PATH环境变量。
4. 检查代理文档以确保安装正确。

**Section sources**
- [README.md](file://README.md#L200-L210)
- [scripts/bash/check-prerequisites.sh](file://scripts/bash/check-prerequisites.sh#L103-L110)

## 脚本执行错误

### 特征目录未找到
**症状**：脚本报告"Feature directory not found"错误。

**可能原因**：
- 未运行`/specify`命令创建特征结构
- 当前不在正确的Git分支上
- 项目结构不符合预期

**解决方案**：
1. 确保已运行`/specify`命令：
```bash
/specify 描述你的项目需求
```
2. 验证当前Git分支命名是否符合规范（如`001-feature-name`）：
```bash
git branch --show-current
```
3. 如果使用非Git仓库，确保`SPECIFY_FEATURE`环境变量已设置：
```bash
export SPECIFY_FEATURE=001-my-feature
```

### 计划文件未找到
**症状**：脚本报告"plan.md not found"错误。

**可能原因**：
- 未运行`/plan`命令创建实施计划
- 计划文件未生成在预期位置

**解决方案**：
1. 运行`/plan`命令创建实施计划：
```bash
/plan 描述你的技术栈和架构选择
```
2. 验证计划文件是否存在：
```bash
ls specs/$(git branch --show-current)/plan.md
```

### 任务文件未找到
**症状**：脚本报告"tasks.md not found"错误。

**可能原因**：
- 未运行`/tasks`命令生成任务列表
- 实施阶段缺少必要文件

**解决方案**：
1. 运行`/tasks`命令生成任务列表：
```bash
/tasks
```
2. 验证任务文件是否存在：
```bash
ls specs/$(git branch --show-current)/tasks.md
```

**Section sources**
- [scripts/bash/check-prerequisites.sh](file://scripts/bash/check-prerequisites.sh#L103-L120)
- [scripts/powershell/check-prerequisites.ps1](file://scripts/powershell/check-prerequisites.ps1#L89-L102)

## 诊断技巧

### 查看详细错误日志
**方法**：
1. 使用`--debug`标志启用详细输出：
```bash
specify init my-project --ai claude --debug
```
2. 检查脚本输出中的具体错误信息。
3. 根据错误信息定位问题根源。

### 验证Git分支
**方法**：
1. 检查当前分支是否为特征分支：
```bash
git branch --show-current
```
2. 特征分支应以三位数字开头，如`001-feature-name`。
3. 如果不在特征分支上，切换到正确的分支或创建新分支。

### 检查环境变量
**方法**：
1. 验证`SPECIFY_FEATURE`环境变量：
```bash
echo $SPECIFY_FEATURE
```
2. 如果需要，设置该变量：
```bash
export SPECIFY_FEATURE=001-my-feature
```

### 使用路径仅模式
**方法**：
使用`--paths-only`选项仅输出路径变量，帮助诊断路径问题：
```bash
./scripts/bash/check-prerequisites.sh --paths-only
```

**Section sources**
- [scripts/bash/check-prerequisites.sh](file://scripts/bash/check-prerequisites.sh#L130-L150)
- [scripts/powershell/check-prerequisites.ps1](file://scripts/powershell/check-prerequisites.ps1#L60-L80)